<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM User Flow Diagram</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5rem;
            font-weight: 700;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }
        #user-flow-diagram {
            width: 100%;
            height: 1000px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            overflow: auto;
        }
        .download-section {
            text-align: center;
            margin-top: 30px;
        }
        .download-btn {
            background: #4299e1;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
            margin: 0 10px;
        }
        .download-btn:hover {
            background: #3182ce;
        }
        .flow-legend {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            font-size: 14px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4a5568;
        }
        .legend-shape {
            width: 30px;
            height: 20px;
            border: 2px solid #4a5568;
        }
        .rect { border-radius: 4px; background: #e2e8f0; }
        .diamond { 
            width: 20px; 
            height: 20px; 
            transform: rotate(45deg); 
            background: #fed7d7; 
            border-color: #f56565;
        }
        .oval { 
            border-radius: 50%; 
            background: #c6f6d5; 
            border-color: #48bb78;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ CRM User Flow Diagram</h1>
        <p class="subtitle">Complete User Journey Including Authentication & Password Reset Flow</p>
        
        <div id="user-flow-diagram"></div>
        
        <div class="flow-legend">
            <div class="legend-item">
                <div class="legend-shape oval"></div>
                <span>Start/End Point</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape rect"></div>
                <span>Process/Action</span>
            </div>
            <div class="legend-item">
                <div class="legend-shape diamond"></div>
                <span>Decision Point</span>
            </div>
        </div>

        <div class="download-section">
            <button class="download-btn" onclick="downloadSVG()">üì• Download User Flow (SVG)</button>
            <button class="download-btn" onclick="downloadPNG()">üñºÔ∏è Download User Flow (PNG)</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.2/svg.min.js"></script>
    <script>
        // Create SVG canvas
        const draw = SVG().addTo('#user-flow-diagram').size('100%', '100%');
        
        // Colors
        const colors = {
            start: '#48bb78',      // Green for start/end
            process: '#4299e1',    // Blue for processes
            decision: '#f56565',   // Red for decisions
            auth: '#9f7aea',       // Purple for auth
            email: '#ed8936',      // Orange for email
            success: '#38b2ac',    // Teal for success
            text: '#2d3748',
            arrow: '#718096',
            border: '#e2e8f0'
        };

        // Helper functions
        function createRectangle(x, y, width, height, color, text, textSize = 11) {
            const group = draw.group();
            
            group.rect(width, height)
                .attr({
                    x: x,
                    y: y,
                    rx: 6,
                    ry: 6,
                    fill: color,
                    stroke: '#ffffff',
                    'stroke-width': 2
                });
            
            // Multi-line text handling
            const lines = text.split('\\n');
            const textGroup = group.group();
            
            lines.forEach((line, index) => {
                textGroup.text(line)
                    .attr({
                        x: x + width/2,
                        y: y + height/2 - (lines.length - 1) * 7 + index * 14,
                        'text-anchor': 'middle',
                        'dominant-baseline': 'central',
                        fill: 'white',
                        'font-size': textSize,
                        'font-weight': '600'
                    });
            });
                
            return group;
        }

        function createDiamond(x, y, width, height, color, text, textSize = 10) {
            const group = draw.group();
            
            const centerX = x + width/2;
            const centerY = y + height/2;
            
            group.polygon([
                [centerX, y],           // top
                [x + width, centerY],   // right  
                [centerX, y + height],  // bottom
                [x, centerY]            // left
            ]).attr({
                fill: color,
                stroke: '#ffffff',
                'stroke-width': 2
            });
            
            // Multi-line text for diamond
            const lines = text.split('\\n');
            lines.forEach((line, index) => {
                group.text(line)
                    .attr({
                        x: centerX,
                        y: centerY - (lines.length - 1) * 6 + index * 12,
                        'text-anchor': 'middle',
                        'dominant-baseline': 'central',
                        fill: 'white',
                        'font-size': textSize,
                        'font-weight': '600'
                    });
            });
                
            return group;
        }

        function createOval(x, y, width, height, color, text, textSize = 11) {
            const group = draw.group();
            
            group.ellipse(width, height)
                .attr({
                    cx: x + width/2,
                    cy: y + height/2,
                    fill: color,
                    stroke: '#ffffff',
                    'stroke-width': 2
                });
            
            const lines = text.split('\\n');
            lines.forEach((line, index) => {
                group.text(line)
                    .attr({
                        x: x + width/2,
                        y: y + height/2 - (lines.length - 1) * 7 + index * 14,
                        'text-anchor': 'middle',
                        'dominant-baseline': 'central',
                        fill: 'white',
                        'font-size': textSize,
                        'font-weight': '600'
                    });
            });
                
            return group;
        }

        function createArrow(x1, y1, x2, y2, label = '', curved = false) {
            const group = draw.group();
            
            if (curved) {
                const midX = (x1 + x2) / 2;
                const midY = Math.min(y1, y2) - 30;
                
                group.path(`M ${x1} ${y1} Q ${midX} ${midY} ${x2} ${y2}`)
                    .attr({
                        fill: 'none',
                        stroke: colors.arrow,
                        'stroke-width': 2,
                        'marker-end': 'url(#arrowhead)'
                    });
                    
                if (label) {
                    group.text(label)
                        .attr({
                            x: midX,
                            y: midY - 10,
                            'text-anchor': 'middle',
                            fill: colors.arrow,
                            'font-size': 9,
                            'font-weight': '500'
                        });
                }
            } else {
                group.line(x1, y1, x2, y2)
                    .attr({
                        stroke: colors.arrow,
                        'stroke-width': 2,
                        'marker-end': 'url(#arrowhead)'
                    });
                    
                if (label) {
                    const midX = (x1 + x2) / 2;
                    const midY = (y1 + y2) / 2;
                    group.text(label)
                        .attr({
                            x: midX + 10,
                            y: midY - 5,
                            'text-anchor': 'middle',
                            fill: colors.arrow,
                            'font-size': 9,
                            'font-weight': '500'
                        });
                }
            }
                
            return group;
        }

        // Create arrowhead marker
        const defs = draw.defs();
        defs.marker(10, 10, function(add) {
            add.path('M 0 0 L 10 5 L 0 10 z').fill(colors.arrow);
        }).attr({
            id: 'arrowhead',
            refX: 9,
            refY: 5,
            markerUnits: 'strokeWidth',
            orient: 'auto'
        });

        // MAIN FLOW - Starting from top
        
        // Start
        createOval(50, 30, 120, 50, colors.start, 'User Visits\\nCRM System');
        
        // Landing/Login Check
        createDiamond(30, 120, 160, 60, colors.decision, 'User\\nAuthenticated?');
        
        // Left side - Login Flow
        createRectangle(200, 30, 120, 50, colors.auth, 'Show Login\\nPage');
        createRectangle(200, 120, 120, 50, colors.process, 'Enter Email\\n& Password');
        createDiamond(180, 210, 160, 60, colors.decision, 'Valid\\nCredentials?');
        
        // Login Success
        createRectangle(400, 120, 120, 50, colors.success, 'Generate\\nJWT Token');
        createRectangle(400, 210, 120, 50, colors.success, 'Redirect to\\nDashboard');
        
        // Forgot Password Flow (Right side)
        createRectangle(600, 30, 120, 50, colors.auth, 'Click Forgot\\nPassword?');
        createRectangle(600, 120, 120, 50, colors.process, 'Enter Email\\nAddress');
        createDiamond(580, 210, 160, 60, colors.decision, 'Email Exists\\nin System?');
        
        // OTP Flow
        createRectangle(800, 120, 120, 50, colors.email, 'Send OTP\\nto Email');
        createRectangle(800, 210, 120, 50, colors.process, 'Enter 6-Digit\\nOTP');
        createDiamond(780, 300, 160, 60, colors.decision, 'OTP Valid\\n& Not Expired?');
        
        // Password Reset
        createRectangle(1000, 210, 120, 50, colors.process, 'Enter New\\nPassword');
        createRectangle(1000, 300, 120, 50, colors.process, 'Confirm New\\nPassword');
        createDiamond(980, 390, 160, 60, colors.decision, 'Passwords\\nMatch?');
        createRectangle(1000, 500, 120, 50, colors.success, 'Update Password\\nin Database');
        createRectangle(1000, 590, 120, 50, colors.success, 'Show Success\\nMessage');
        
        // Main Dashboard Flow
        createRectangle(50, 350, 120, 50, colors.success, 'Dashboard\\nLoaded');
        
        // Dashboard Features
        createRectangle(200, 350, 100, 40, colors.process, 'View\\nCustomers');
        createRectangle(320, 350, 100, 40, colors.process, 'Manage\\nProjects');
        createRectangle(440, 350, 100, 40, colors.process, 'Track\\nTasks');
        createRectangle(560, 350, 100, 40, colors.process, 'View\\nActivities');
        
        // User Actions
        createDiamond(200, 450, 160, 60, colors.decision, 'User Wants to\\nPerform Action?');
        
        // CRUD Operations
        createRectangle(50, 550, 100, 40, colors.process, 'Create\\nRecord');
        createRectangle(170, 550, 100, 40, colors.process, 'Read\\nRecord');
        createRectangle(290, 550, 100, 40, colors.process, 'Update\\nRecord');
        createRectangle(410, 550, 100, 40, colors.process, 'Delete\\nRecord');
        
        // API Calls
        createRectangle(200, 650, 120, 50, colors.process, 'Send API\\nRequest');
        createDiamond(180, 740, 160, 60, colors.decision, 'API Request\\nSuccessful?');
        
        // Success/Error Handling
        createRectangle(50, 850, 120, 50, colors.success, 'Update UI\\nShow Success');
        createRectangle(200, 850, 120, 50, colors.process, 'Show Error\\nMessage');
        
        // Logout Flow
        createRectangle(600, 450, 120, 50, colors.auth, 'User Clicks\\nLogout');
        createRectangle(600, 550, 120, 50, colors.auth, 'Clear JWT\\nToken');
        createOval(600, 650, 120, 50, colors.start, 'Redirect to\\nLogin Page');
        
        // Error Flows
        createRectangle(400, 300, 120, 50, colors.process, 'Show Error\\nMessage');
        createRectangle(800, 390, 120, 50, colors.process, 'Show Invalid\\nOTP Error');
        
        // ARROWS - Main Flow
        createArrow(110, 80, 110, 120);  // Start to auth check
        createArrow(30, 150, 200, 60, 'No', true);  // Not auth to login
        createArrow(260, 80, 260, 120);  // Login page to enter creds
        createArrow(260, 170, 260, 210);  // Enter creds to validation
        createArrow(340, 240, 400, 145, 'Yes');  // Valid creds to token
        createArrow(460, 120, 460, 210);  // Token to dashboard redirect
        createArrow(190, 150, 50, 350, 'Yes', true);  // Auth yes to dashboard
        
        // Forgot Password Flow Arrows
        createArrow(320, 60, 600, 60, 'Forgot Password');  // Login to forgot password
        createArrow(660, 80, 660, 120);  // Forgot password to enter email
        createArrow(660, 170, 660, 210);  // Enter email to check exists
        createArrow(740, 240, 800, 145, 'Yes');  // Email exists to send OTP
        createArrow(860, 170, 860, 210);  // Send OTP to enter OTP
        createArrow(860, 260, 860, 300);  // Enter OTP to validation
        createArrow(940, 330, 1000, 235, 'Yes');  // Valid OTP to new password
        createArrow(1060, 260, 1060, 300);  // New password to confirm
        createArrow(1060, 350, 1060, 390);  // Confirm to match check
        createArrow(1060, 450, 1060, 500, 'Yes');  // Match yes to update DB
        createArrow(1060, 550, 1060, 590);  // Update to success
        
        // Error flows
        createArrow(180, 240, 400, 325, 'No');  // Invalid creds
        createArrow(580, 240, 400, 325, 'No');  // Email not found
        createArrow(780, 330, 800, 415, 'No');  // Invalid OTP
        createArrow(980, 420, 800, 415, 'No');  // Passwords don't match
        
        // Dashboard flows
        createArrow(110, 400, 200, 370);  // Dashboard to customers
        createArrow(110, 400, 320, 370);  // Dashboard to projects  
        createArrow(110, 400, 440, 370);  // Dashboard to tasks
        createArrow(110, 400, 560, 370);  // Dashboard to activities
        
        // Action flows
        createArrow(280, 450, 280, 480);  // Action decision
        createArrow(200, 480, 100, 550, 'Create');  // Create action
        createArrow(220, 480, 220, 550, 'Read');  // Read action
        createArrow(260, 480, 340, 550, 'Update');  // Update action
        createArrow(320, 480, 460, 550, 'Delete');  // Delete action
        
        // API flows
        createArrow(220, 590, 260, 650);  // Actions to API
        createArrow(260, 700, 260, 740);  // API to validation
        createArrow(180, 770, 110, 850, 'Yes');  // Success flow
        createArrow(340, 770, 260, 850, 'No');  // Error flow
        
        // Logout flow
        createArrow(560, 370, 660, 450);  // Dashboard to logout
        createArrow(660, 500, 660, 550);  // Logout to clear token
        createArrow(660, 600, 660, 650);  // Clear token to redirect
        
        // Success flows back to dashboard
        createArrow(110, 850, 110, 400, '', true);  // Success back to dashboard
        createArrow(1120, 615, 110, 400, '', true);  // Password reset success back
        
        // Download functions
        window.downloadSVG = function() {
            const svgElement = document.querySelector('#user-flow-diagram svg');
            const svgData = new XMLSerializer().serializeToString(svgElement);
            const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
            const svgUrl = URL.createObjectURL(svgBlob);
            
            const downloadLink = document.createElement('a');
            downloadLink.href = svgUrl;
            downloadLink.download = 'crm-user-flow-diagram.svg';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        };

        window.downloadPNG = function() {
            const svgElement = document.querySelector('#user-flow-diagram svg');
            const svgData = new XMLSerializer().serializeToString(svgElement);
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            canvas.width = 1400;
            canvas.height = 1000;
            
            img.onload = function() {
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                
                const pngUrl = canvas.toDataURL('image/png');
                const downloadLink = document.createElement('a');
                downloadLink.href = pngUrl;
                downloadLink.download = 'crm-user-flow-diagram.png';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            };
            
            img.src = 'data:image/svg+xml;base64,' + btoa(svgData);
        };
    </script>
</body>
</html>
